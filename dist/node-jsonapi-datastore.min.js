!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=function(){function i(e,n){t(this,i),this.id=n,this._type=e,this._attributes=[],this._dependents=[],this._relationships=[]}return e(i,[{key:"_addDependence",value:function(t,e,i){var n,a=this;n=a._dependents.filter(function(n){return n.id===e&&n.type===t&&n.relation===i}),0===n.length&&a._dependents.push({id:e,type:t,relation:i})}},{key:"_removeDependence",value:function(t,e){var i=this;i._dependents.forEach(function(n,a){n.id===e&&n.type===t&&i._dependents.splice(a,1)})}},{key:"removeRelationship",value:function(t,e,i){var n=this;n._removeDependence(t,e),n[i].constructor===Array?n[i].forEach(function(a,r){a.id===e&&a.type===t&&n[i].splice(r,1)}):n[i].id===e&&(n[i]=null)}},{key:"serialize",value:function(t){var e=this,i={data:{type:this._type}};return t=t||{},t.attributes=t.attributes||this._attributes,t.relationships=t.relationships||this._relationships,void 0!==this.id&&(i.data.id=this.id),0!==t.attributes.length&&(i.data.attributes={}),0!==t.relationships.length&&(i.data.relationships={}),t.attributes.forEach(function(t){i.data.attributes[t]=e[t]}),t.relationships.forEach(function(t){function n(t){return{type:t._type,id:t.id}}e[t]?e[t].constructor===Array?i.data.relationships[t]={data:e[t].map(n)}:i.data.relationships[t]={data:n(e[t])}:i.data.relationships[t]={data:null}}),i}},{key:"setAttribute",value:function(t,e){void 0===this[t]&&this._attributes.push(t),this[t]=e}},{key:"setRelationship",value:function(t,e){void 0===this[t]&&this._relationships.push(t),this[t]=e}}]),i}(),n=function(){function n(){t(this,n),this.graph={}}return e(n,[{key:"destroy",value:function(t){var e=this;t._dependents.forEach(function(i,n){e.graph[i.type][i.id].removeRelationship(t._type,t.id,i.relation)}),delete this.graph[t._type][t.id]}},{key:"find",value:function(t,e){return this.graph[t]&&this.graph[t][e]?this.graph[t][e]:null}},{key:"findAll",value:function(t){var e=this;return this.graph[t]?Object.keys(e.graph[t]).map(function(i){return e.graph[t][i]}):[]}},{key:"reset",value:function(){this.graph={}}},{key:"initModel",value:function(t,e){return this.graph[t]=this.graph[t]||{},this.graph[t][e]=this.graph[t][e]||new i(t,e),this.graph[t][e]}},{key:"syncRecord",value:function(t){function e(t){if(!n.find(t.type,t.id)){var e=n.initModel(t.type,t.id);e._placeHolder=!0}return n.graph[t.type][t.id]}var i,n=this,a=this.initModel(t.type,t.id);delete a._placeHolder;for(i in t.attributes)a._attributes.push(i),a[i]=t.attributes[i];if(t.relationships)for(i in t.relationships){var r=t.relationships[i];void 0!==r.data&&(a._relationships.push(i),null===r.data?a[i]=null:r.data.constructor===Array?(a[i]=r.data.map(e),a[i].forEach(function(t,e){t._addDependence(a._type,a.id,e)})):(a[i]=e(r.data),a[i]._addDependence(a._type,a.id,i))),r.links&&console.log("Warning: Links not implemented yet.")}return a}},{key:"syncWithMeta",value:function(t){var e=t.data,i=this.syncRecord.bind(this);return e?(t.included&&t.included.map(i),{data:e.constructor===Array?e.map(i):i(e),meta:"meta"in t?t.meta:null}):[]}},{key:"sync",value:function(t){return this.syncWithMeta(t).data}}]),n}();"undefined"!=typeof module&&(module.exports={JsonApiDataStore:n,JsonApiDataStoreModel:i}),exports.JsonApiDataStore=n,exports.JsonApiDataStoreModel=i}();